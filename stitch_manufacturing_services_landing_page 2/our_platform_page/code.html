<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>国际学生证生成器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    /* 小样式微调 */
    body { background:#f7fafc; }
    .card-front, .card-back { width: 360px; border-radius: 12px; box-shadow: 0 6px 18px rgba(17,24,39,0.08); background:#fff; }
    .photo-placeholder { width:110px;height:110px;border-radius:8px;background:#f1f5f9;display:flex;align-items:center;justify-content:center;color:#94a3b8;font-size:14px; }
    /* 保证下载时渲染清晰 */
    .render-root { padding: 18px; background: transparent; }
  </style>
</head>
<body class="p-8">
  <div class="max-w-6xl mx-auto">
    <div class="bg-white rounded-xl p-6 shadow-sm">
      <h1 class="text-2xl font-bold text-red-600 text-center mb-4">国际学生证生成器</h1>
      <div class="flex gap-8">
        <!-- 左侧表单 -->
        <div class="w-1/2">
          <div class="space-y-4">
            <div class="bg-gray-50 p-4 rounded-lg border">
              <h2 class="font-medium mb-2">正面信息</h2>
              <div class="space-y-3">
                <label class="block">
                  <div class="text-sm text-gray-600">大学名称（英文）</div>
                  <input id="input-univ" class="mt-1 w-full rounded-md border px-3 py-2" placeholder="例如：Peking University" />
                </label>

                <label class="block">
                  <div class="text-sm text-gray-600">学生姓名（英文全名）</div>
                  <input id="input-name" class="mt-1 w-full rounded-md border px-3 py-2" placeholder="例如：Zhang Wei" />
                </label>

                <div class="grid grid-cols-2 gap-3">
                  <label>
                    <div class="text-sm text-gray-600">学号</div>
                    <input id="input-id" class="mt-1 w-full rounded-md border px-3 py-2" placeholder="例如：INT2025001" />
                  </label>
                  <label>
                    <div class="text-sm text-gray-600">院系/专业（英文）</div>
                    <input id="input-faculty" class="mt-1 w-full rounded-md border px-3 py-2" placeholder="例如：School of Computer Science" />
                  </label>
                </div>

                <div class="grid grid-cols-2 gap-3">
                  <label>
                    <div class="text-sm text-gray-600">签发日期</div>
                    <input id="input-issue" type="date" class="mt-1 w-full rounded-md border px-3 py-2" />
                  </label>
                  <label>
                    <div class="text-sm text-gray-600">有效期至</div>
                    <input id="input-expire" type="date" class="mt-1 w-full rounded-md border px-3 py-2" />
                  </label>
                </div>

                <div class="grid grid-cols-2 gap-3">
                  <label>
                    <div class="text-sm text-gray-600">上传头像</div>
                    <input id="input-photo" type="file" accept="image/*" class="mt-1" />
                  </label>

                  <label>
                    <div class="text-sm text-gray-600">上传学校 Logo（可选）</div>
                    <input id="input-logo" type="file" accept="image/*" class="mt-1" />
                  </label>
                </div>

                <label>
                  <div class="text-sm text-gray-600">自定义头部颜色</div>
                  <input id="input-color" type="color" value="#e11d48" class="mt-1 w-20 h-10 p-0 border rounded" />
                </label>

                <div class="flex gap-2">
                  <button id="btn-random" class="bg-gray-200 px-3 py-2 rounded">随机生成</button>
                  <button id="btn-fill-all" class="bg-blue-600 text-white px-3 py-2 rounded">一键填充示例</button>
                  <button id="btn-clear" class="bg-red-500 text-white px-3 py-2 rounded">清空</button>
                </div>
              </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg border">
              <h2 class="font-medium mb-2">背面信息</h2>
              <label class="block">
                <div class="text-sm text-gray-600">持卡人地址（英文）</div>
                <input id="input-address" class="mt-1 w-full rounded-md border px-3 py-2" placeholder="例如：No. 5 Yiheyuan Road, Haidian District, Beijing" />
              </label>
              <label class="block">
                <div class="text-sm text-gray-600">官方声明/备注（英文）</div>
                <textarea id="input-note" rows="3" class="mt-1 w-full rounded-md border p-2" placeholder="例如：This card is university property..."></textarea>
              </label>
            </div>
          </div>
        </div>

        <!-- 右侧预览 -->
        <div class="w-1/2 flex flex-col items-center gap-6">
          <div class="w-full flex justify-center">
            <!-- 预览容器：正面 -->
            <div id="card-front" class="card-front render-root overflow-hidden">
              <div id="front-head" class="h-20 px-4 flex items-center justify-between" style="background:#e11d48;">
                <div>
                  <div id="front-univ" class="text-white font-bold">UNIVERSITY NAME</div>
                  <div class="text-white text-xs">国际学生证</div>
                </div>
                <div id="front-logo" class="w-16 h-16 rounded overflow-hidden bg-white/50 flex items-center justify-center">
                  <!-- logo img -->
                </div>
              </div>

              <div class="p-4 flex gap-4">
                <div class="flex-shrink-0">
                  <div id="front-photo" class="photo-placeholder">PHOTO</div>
                </div>
                <div class="flex-1">
                  <div class="text-sm text-gray-500">姓名</div>
                  <div id="front-name" class="text-lg font-semibold text-gray-900">STUDENT NAME</div>

                  <div class="mt-3 text-sm text-gray-500">学号</div>
                  <div id="front-id" class="text-sm text-gray-800">STUDENT ID</div>

                  <div class="mt-3 text-sm text-gray-500">院系/专业</div>
                  <div id="front-faculty" class="text-sm text-gray-800">FACULTY NAME</div>

                  <div class="mt-4 flex justify-between text-xs text-gray-500">
                    <div>
                      <div class="text-xs">签发日期</div>
                      <div id="front-issue">YYYY-MM-DD</div>
                    </div>
                    <div>
                      <div class="text-xs">有效期至</div>
                      <div id="front-expire">YYYY-MM-DD</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 下载按钮 -->
          <div class="w-full flex gap-4 justify-center">
            <button id="download-front" class="px-4 py-2 bg-gray-300 rounded">下载正面 (PNG)</button>
          </div>

          <!-- 背面预览 -->
          <div class="w-full flex justify-center">
            <div id="card-back" class="card-back render-root overflow-hidden">
              <div class="h-8 bg-black"></div>
              <div class="p-4">
                <div class="text-sm text-gray-500" id="back-address-title">持卡人地址</div>
                <div id="back-address" class="text-sm text-gray-800 mt-1">HOLDER'S ADDRESS</div>

                <div class="mt-4 text-sm text-gray-500">官方声明</div>
                <div id="back-note" class="text-sm text-gray-700 mt-1 italic">This card is university property...</div>

                <div class="mt-6 text-right">
                  <div class="text-lg font-semibold" id="back-name-sig">Your Name</div>
                  <div class="text-xs text-gray-400">持卡人签名</div>
                </div>
              </div>
            </div>
          </div>

          <div class="w-full flex gap-4 justify-center">
            <button id="download-back" class="px-4 py-2 bg-gray-300 rounded">下载背面 (PNG)</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // 元素绑定
  const inputUniv = document.getElementById('input-univ');
  const inputName = document.getElementById('input-name');
  const inputId = document.getElementById('input-id');
  const inputFaculty = document.getElementById('input-faculty');
  const inputIssue = document.getElementById('input-issue');
  const inputExpire = document.getElementById('input-expire');
  const inputPhoto = document.getElementById('input-photo');
  const inputLogo = document.getElementById('input-logo');
  const inputColor = document.getElementById('input-color');
  const inputAddress = document.getElementById('input-address');
  const inputNote = document.getElementById('input-note');

  const frontUniv = document.getElementById('front-univ');
  const frontName = document.getElementById('front-name');
  const frontId = document.getElementById('front-id');
  const frontFaculty = document.getElementById('front-faculty');
  const frontIssue = document.getElementById('front-issue');
  const frontExpire = document.getElementById('front-expire');
  const frontHead = document.getElementById('front-head');
  const frontPhoto = document.getElementById('front-photo');
  const frontLogo = document.getElementById('front-logo');

  const backAddress = document.getElementById('back-address');
  const backNote = document.getElementById('back-note');
  const backNameSig = document.getElementById('back-name-sig');

  const cardFront = document.getElementById('card-front');
  const cardBack = document.getElementById('card-back');

  // 更新函数
  function updatePreview() {
    frontUniv.textContent = inputUniv.value || 'UNIVERSITY NAME';
    frontName.textContent = inputName.value || 'STUDENT NAME';
    frontId.textContent = inputId.value || 'STUDENT ID';
    frontFaculty.textContent = inputFaculty.value || 'FACULTY NAME';
    frontIssue.textContent = inputIssue.value || 'YYYY-MM-DD';
    frontExpire.textContent = inputExpire.value || 'YYYY-MM-DD';
    frontHead.style.background = inputColor.value || '#e11d48';
    backAddress.textContent = inputAddress.value || "HOLDER'S ADDRESS";
    backNote.textContent = inputNote.value || 'This card is university property. If found, please return to the nearest university office.';
    backNameSig.textContent = inputName.value || 'Your Name';
  }

  // 监听 input
  [inputUniv,inputName,inputId,inputFaculty,inputIssue,inputExpire,inputAddress,inputNote,inputColor].forEach(el=>{
    el.addEventListener('input', updatePreview);
  });

  // 头像上传
  inputPhoto.addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0];
    if(!f) { frontPhoto.innerHTML = 'PHOTO'; return; }
    const reader = new FileReader();
    reader.onload = function(ev){
      frontPhoto.innerHTML = '';
      const img = document.createElement('img');
      img.src = ev.target.result;
      img.style.width = '110px';
      img.style.height = '110px';
      img.style.objectFit = 'cover';
      img.style.borderRadius = '8px';
      frontPhoto.appendChild(img);
    }
    reader.readAsDataURL(f);
  });

  // logo 上传
  inputLogo.addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0];
    frontLogo.innerHTML = '';
    if(!f) { return; }
    const reader = new FileReader();
    reader.onload = function(ev){
      const img = document.createElement('img');
      img.src = ev.target.result;
      img.style.width = '56px';
      img.style.height = '56px';
      img.style.objectFit = 'contain';
      frontLogo.appendChild(img);
    }
    reader.readAsDataURL(f);
  });

  // 随机示例 / 一键填充 / 清空
  document.getElementById('btn-random').addEventListener('click', ()=>{
    const names = ['Li Wei','Anna Chen','Marcus Liu','Zhang Wei','Sofia Wang'];
    const univs = ['Peking University','Tsinghua University','Fudan University','Shanghai Jiao Tong University','University of Tokyo'];
    const faculties = ['School of Computer Science','School of Economics','Faculty of Arts','College of Engineering'];
    inputName.value = names[Math.floor(Math.random()*names.length)];
    inputUniv.value = univs[Math.floor(Math.random()*univs.length)];
    inputId.value = 'INT' + (Math.floor(100000 + Math.random()*900000));
    inputFaculty.value = faculties[Math.floor(Math.random()*faculties.length)];
    const today = new Date();
    const issue = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const expire = new Date(issue.getFullYear() + 1, issue.getMonth(), issue.getDate());
    inputIssue.valueAsDate = issue;
    inputExpire.valueAsDate = expire;
    inputAddress.value = 'No. 5 Yiheyuan Road, Haidian District, Beijing';
    inputNote.value = 'This card is university property. If found, please return to the nearest university office.';
    updatePreview();
  });

  document.getElementById('btn-fill-all').addEventListener('click', ()=>{
    inputUniv.value = 'Peking University';
    inputName.value = 'Zhang Wei';
    inputId.value = 'INT2025001';
    inputFaculty.value = 'School of Computer Science';
    inputIssue.value = '2025-08-01';
    inputExpire.value = '2026-08-01';
    inputAddress.value = 'No. 5 Yiheyuan Road, Haidian District, Beijing';
    inputNote.value = 'This card is university property. If found, please return to the nearest university office.';
    updatePreview();
  });

  document.getElementById('btn-clear').addEventListener('click', ()=>{
    [inputUniv,inputName,inputId,inputFaculty,inputIssue,inputExpire,inputAddress,inputNote].forEach(i=>i.value = '');
    frontPhoto.innerHTML = 'PHOTO';
    frontLogo.innerHTML = '';
    updatePreview();
  });

  updatePreview();

  // 下载（使用 html2canvas）
  function downloadElementAsImage(element, filename) {
    // 临时调整一些样式，保证截图干净
    const scale = 2; // 提升分辨率
    const originalWidth = element.offsetWidth;
    const originalHeight = element.offsetHeight;

    html2canvas(element, {
      backgroundColor: null,
      scale: scale,
      useCORS: true,
      // allowTaint: true
    }).then(canvas => {
      canvas.toBlob(blob => {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
      }, 'image/png');
    }).catch(err=>{
      alert('导出失败：' + err);
    });
  }

  document.getElementById('download-front').addEventListener('click', ()=>{
    // 克隆卡片到临时节点（避免页面缩放/受外部 CSS 影响），保持白底
    const clone = cardFront.cloneNode(true);
    clone.style.transform = 'scale(1)';
    clone.style.margin = '16px';
    const wrapper = document.createElement('div');
    wrapper.style.display = 'inline-block';
    wrapper.style.background = 'white';
    wrapper.appendChild(clone);
    document.body.appendChild(wrapper);
    // 等待图片加载
    setTimeout(()=> {
      downloadElementAsImage(clone, (inputName.value || 'student') + '-card-front.png');
      setTimeout(()=> wrapper.remove(), 800);
    }, 250);
  });

  document.getElementById('download-back').addEventListener('click', ()=>{
    const clone = cardBack.cloneNode(true);
    clone.style.transform = 'scale(1)';
    clone.style.margin = '16px';
    const wrapper = document.createElement('div');
    wrapper.style.display = 'inline-block';
    wrapper.style.background = 'white';
    wrapper.appendChild(clone);
    document.body.appendChild(wrapper);
    setTimeout(()=> {
      downloadElementAsImage(clone, (inputName.value || 'student') + '-card-back.png');
      setTimeout(()=> wrapper.remove(), 800);
    }, 250);
  });

  // 防止按键触发默认表单提交（页面无 form，但保险）
  window.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      // 阻止在输入框里回车导致意外行为
      if (document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA')) {
        e.preventDefault();
      }
    }
  });
</script>
</body>
</html>
